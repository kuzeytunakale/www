<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuring Crawl Jobs &mdash; Heritrix 3  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Bean Reference" href="bean-reference.html" />
    <link rel="prev" title="Operating Heritrix" href="operating.html" /> 
<script async type="text/javascript" src="../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="heritrix" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/configuring-jobs.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Heritrix 3
          </a>
              <div class="version">
                3.12.1-SNAPSHOT
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started with Heritrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="operating.html">Operating Heritrix</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="configuring-jobs.html#">Configuring Crawl Jobs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#basic-job-settings">Basic Job Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#crawl-limits">Crawl Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#maxtoethreads">maxToeThreads</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#metadata-operatorcontacturl">metadata.operatorContactUrl</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#robots-txt-honoring-policy">Robots.txt Honoring Policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#crawl-scope">Crawl Scope</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#decide-rules">Decide Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#deciderulesequence-logging">DecideRuleSequence Logging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#frontier">Frontier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#politeness">Politeness</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#retry-policy">Retry Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#bandwidth-limits">Bandwidth Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#extractor-parameters">Extractor Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#sheets-site-specific-settings">Sheets (Site-specific Settings)</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#authentication-and-cookies">Authentication and Cookies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#credential-store">Credential Store</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#http-basic-and-digest-authentication">HTTP Basic and Digest Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#html-form-authentication">HTML Form Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#loading-cookies">Loading Cookies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#other-protocols">Other Protocols</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#ftp">FTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#http-2">HTTP/2</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#http-3">HTTP/3</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#sftp">SFTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#whois">WHOIS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring-jobs.html#modifying-a-running-job">Modifying a Running Job</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#browse-beans">Browse Beans</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#scripting-console">Scripting Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#configuring-http-proxies">Configuring HTTP Proxies</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#configuring-socks5-proxy">Configuring SOCKS5 Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuring-jobs.html#configuring-dns-over-http-doh">Configuring DNS over HTTP (DoH)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bean-reference.html">Bean Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Heritrix 3</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuring Crawl Jobs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/configuring-jobs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuring-crawl-jobs">
<h1>Configuring Crawl Jobs<a class="headerlink" href="configuring-jobs.html#configuring-crawl-jobs" title="Permalink to this heading"></a></h1>
<section id="basic-job-settings">
<h2>Basic Job Settings<a class="headerlink" href="configuring-jobs.html#basic-job-settings" title="Permalink to this heading"></a></h2>
<p>Crawl settings are configured by editing a job’s crawler-beans.cxml file.  Each job has a <code class="docutils literal notranslate"><span class="pre">crawler-beans.cxml</span></code> file
that contains the Spring configuration for the job.</p>
<section id="crawl-limits">
<h3>Crawl Limits<a class="headerlink" href="configuring-jobs.html#crawl-limits" title="Permalink to this heading"></a></h3>
<p>In addition to limits imposed on the scope of the crawl it is possible to enforce arbitrary limits on the duration
and extent of the crawl with the following settings:</p>
<dl class="simple">
<dt>maxBytesDownload</dt><dd><p>Stop the crawl after a fixed number of bytes have been downloaded. Zero means unlimited.</p>
</dd>
<dt>maxDocumentDownload</dt><dd><p>Stop the crawl after downloading a fixed number of documents. Zero means unlimited.</p>
</dd>
<dt>maxTimeSeconds</dt><dd><p>Stop the crawl after a certain number of seconds have elapsed. Zero means unlimited. For reference there are 3600
seconds in an hour and 86400 seconds in a day.</p>
</dd>
</dl>
<p>To set these values modify the CrawlLimitEnforcer bean.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;crawlLimitEnforcer&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.framework.CrawlLimitEnforcer&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxBytesDownload&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;100000000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxDocumentsDownload&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;100&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxTimeSeconds&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;10000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are not hard limits. Once one of these limits is hit it will trigger a graceful termination of the crawl job.
URIs already being crawled will be completed. As a result the set limit will be exceeded by some amount.</p>
</div>
</section>
<section id="maxtoethreads">
<h3>maxToeThreads<a class="headerlink" href="configuring-jobs.html#maxtoethreads" title="Permalink to this heading"></a></h3>
<p>The maximum number of toe threads to run.</p>
<p>If running a domain crawl smaller than 100 hosts, a value approximately twice the number of hosts should be enough.
Values larger then 150-200 are rarely worthwhile unless running on machines with exceptional resources.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;crawlController&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.framework.CrawlController&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxToeThreads&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;50&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="metadata-operatorcontacturl">
<h3>metadata.operatorContactUrl<a class="headerlink" href="configuring-jobs.html#metadata-operatorcontacturl" title="Permalink to this heading"></a></h3>
<p>The URI of the crawl initiator. This setting gives the administrator of a crawled host a URI to refer to in case of
problems.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;simpleOverrides&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.beans.factory.config.PropertyOverrideConfigurer&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;properties&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;value&gt;</span>
<span class="w">      </span>metadata.operatorContactUrl=http://www.archive.org
<span class="w">      </span>metadata.jobName=basic
<span class="w">      </span>metadata.description=Basic<span class="w"> </span>crawl<span class="w"> </span>starting<span class="w"> </span>with<span class="w"> </span>useful<span class="w"> </span>defaults
<span class="w">    </span><span class="nt">&lt;/value&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="robots-txt-honoring-policy">
<h3>Robots.txt Honoring Policy<a class="headerlink" href="configuring-jobs.html#robots-txt-honoring-policy" title="Permalink to this heading"></a></h3>
<p>The valid values of “robotsPolicyName” are:</p>
<dl class="simple">
<dt>obey</dt><dd><p>Obey robots.txt directives and nofollow robots meta tags</p>
</dd>
<dt>classic</dt><dd><p>Same as “obey”</p>
</dd>
<dt>robotsTxtOnly</dt><dd><p>Obey robots.txt directives but ignore robots meta tags</p>
</dd>
<dt>ignore</dt><dd><p>Ignore robots.txt directives and robots meta tags</p>
</dd>
</dl>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;metadata&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.CrawlMetadata&quot;</span><span class="w"> </span><span class="na">autowire=</span><span class="s">&quot;byName&quot;</span><span class="nt">&gt;</span>
...
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;robotsPolicyName&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;obey&quot;</span><span class="nt">/&gt;</span>
...
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Heritrix supports RFC 9309 path wildcards (<a href="configuring-jobs.html#id1"><span class="problematic" id="id2">*</span></a>, $) in robots.txt rules.</p>
<p>The only supported value for robots meta tags is “nofollow” which will cause the HTML extractor to stop processing
and ignore all links (including embeds like images and stylesheets).</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;robots&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;nofollow&quot;</span><span class="p">/&gt;</span>
</pre></div>
</div>
<p>Obeying “rel=nofollow” on individual links is configured separately as <code class="docutils literal notranslate"><span class="pre">obeyRelNoFollow</span></code> on <code class="docutils literal notranslate"><span class="pre">ExtractorHTML</span></code>.</p>
</div>
</section>
</section>
<section id="crawl-scope">
<h2>Crawl Scope<a class="headerlink" href="configuring-jobs.html#crawl-scope" title="Permalink to this heading"></a></h2>
<p>The crawl scope defines the set of possible URIs that can be captured by a crawl. These URIs are determined by
DecideRules, which work in combination to limit or expand the set of crawled URIs. Each DecideRule, when presented
with an object (most often a URI of some form) responds with one of three decisions:</p>
<dl class="simple">
<dt>ACCEPT</dt><dd><p>the object is ruled in</p>
</dd>
<dt>REJECT</dt><dd><p>the object is ruled out</p>
</dd>
<dt>PASS</dt><dd><p>the rule has no opinion; retain the previous decision</p>
</dd>
</dl>
<p>A URI under consideration begins with no assumed status. Each rule is applied in turn to the candidate URI. If the
rule decides ACCEPT or REJECT, the URI’s status is set accordingly. After all rules have been applied, the URI is
determined to be “in scope” if its status is ACCEPT. If its status is REJECT it is discarded.</p>
<p>We suggest starting with the rules in our recommended default configurations and performing small test crawls with
those rules. Understand why certain URIs are ruled in or ruled out under those rules. Then make small individual
changes to the scope to achieve non-default desired effects. Creating a new ruleset from scratch can be difficult and
can easily result in crawls that can’t make the usual minimal progress that other parts of the crawler expect.
Similarly, making many changes at once can obscure the importance of the interplay and ordering of the rules.</p>
<section id="decide-rules">
<h3>Decide Rules<a class="headerlink" href="configuring-jobs.html#decide-rules" title="Permalink to this heading"></a></h3>
<dl class="simple">
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/AcceptDecideRule.html">DecideRule: AcceptDecideRule</a></dt><dd><p>This DecideRule accepts any URI.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ContentLengthDecideRule.html">DecideRule: ContentLengthDecideRule</a></dt><dd><p>This DecideRule accepts a URI if the content-length is less than the threshold.  The default threshold is 2^63,
meaning any document will be accepted.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/PathologicalPathDecideRule.html">DecideRule: PathologicalPathDecideRule</a></dt><dd><p>This DecideRule rejects any URI that contains an excessive number of identical, consecutive path-segments.  For
example, <code class="docutils literal notranslate"><span class="pre">http://example.com/a/a/a/a/a/foo.html</span></code>.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/PredicatedDecideRule.html">DecideRule: PredicatedDecideRule</a></dt><dd><p>This DecideRule applies a configured decision only if a test evaluates to true.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ExternalGeoLocationDecideRule.html">DecideRule: ExternalGeoLocationDecideRule</a></dt><dd><p>This DecideRule accepts a URI if it is located in a particular country.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/FetchStatusDecideRule.html">DecideRule: FetchStatusDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that has a fetch staus equal to the “target-status” setting.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/HasViaDecideRule.html">DecideRule: HasViaDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that has a “via.”  A via is any URI that is a seed or some kind of mid-crawl addition.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/HopCrossesAssignmentLevelDomainDecideRule.html">DecideRule: HopCrossesAssignmentLevelDomainDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that differs in the portion of its hostname/domain that is assigned/sold by registrars.  The portion is referred to as the “assignment-level-domain” (ALD).</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/IdenticalDigestDecideRule.html">DecideRule: IdenticalDigestDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose prior-history content-digest matches the latest fetch.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/MatchesListRegexDecideRule.html">DecideRule: MatchesListRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that matches the supplied regular expressions.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotMatchesListRegexDecideRule.html">DecideRule: NotMatchesListRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that does not match the supplied regular expressions.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/MatchesRegexDecideRule.html">DecideRule: MatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that matches the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ClassKeyMatchesRegexDecideRule.html">DecideRule: ClassKeyMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI class key that matches the supplied regular expression.  A URI class key is a string that specifies the name of the Frontier queue into which a URI should be placed.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ContentTypeMatchesRegexDecideRule.html">DecideRule: ContentTypeMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose content-type is present and matches the supplied regular expression. The regular expression must match the full content-type sequence. Ex.: <code class="docutils literal notranslate"><span class="pre">s/application/javascript;charset=UTF-8/^application\/javascript.*$/g</span></code>; <code class="docutils literal notranslate"><span class="pre">s/text/html/^.*\/html.*$/g</span></code></p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ContentTypeNotMatchesRegexDecideRule.html">DecideRule: ContentTypeNotMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose content-type does not match the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/FetchStatusMatchesRegexDecideRule.html">DecideRule: FetchStatusMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that has a fetch status that matches the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/FetchStatusNotMatchesRegexDecideRule.html">DecideRule: FetchStatusNotMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that has a fetch status that does not match the suppllied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/HopsPathMatchesRegexDecideRule.html">DecideRule: HopsPathMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose “hops-path” matches the supplied regular expression.  The hops-path is a string that consists of characters representing the path that was taken to access the URI.  An example of a hops-path is “LLXE”.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/MatchesFilePatternDecideRule.html">DecideRule: MatchesFilePatternDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose suffix matches the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotMatchesFilePatternDecideRule.html">DecideRule: NotMatchesFilePatternDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose suffix does not match the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotMatchesRegexDecideRule.html">DecideRule: NotMatchesRegexDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that does not match the supplied regular expression.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotExceedsDocumentLengthThresholdDecideRule.html">DecideRule: NotExceedsDocumentLengthThresholdDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose content-length does not exceed the configured threshold.  The content-length comes from either the HTTP header or the actual downloaded content length of the URI.  As of Heritrix 3.1, this rule has been renamed to ResourceNoLongerThanDecideRule.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ExceedsDocumentLengthThresholdDecideRule.html">DecideRule: ExceedsDocumentLengthThresholdDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI whose content length exceeds the configured threshold.  The content-length comes from either the HTTP header or the actual downloaded content length of the URI.  As of Heritrix 3.1, this rule has been renamed to ResourceLongerThanDecideRule.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/SurtPrefixedDecideRule.html">DecideRule: SurtPrefixedDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI (expressed in SURT form) that begins with one of the
prefixes in the configured set. This DecideRule returns true when the prefix of a given URI matches any of the
listed SURTs. The list of SURTs may be configured in different ways: the surtsSourceFile parameter specifies a file
to read the SURTs list from.  If seedsAsSurtPrefixes parameter is set to true, SurtPrefixedDecideRule adds all seeds
to the SURTs list. If alsoCheckVia property is set to true (default false), SurtPrefixedDecideRule will also
consider Via URIs in the match.
As of Heritrix 3.1, the “surtsSource” parameter may be any ReadSource, such as a ConfigFile or a ConfigString.
This gives the SurtPrefixedDecideRule the flexibility of the TextSeedModule bean’s “textSource” property.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotSurtPrefixedDecideRule.html">DecideRule: NotSurtPrefixedDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI (expressed in SURT form) that does not begin with one of the prefixes in the configured set.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/OnDomainsDecideRule.html">DecideRule: OnDomainsDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that is in one of the domains of the configured set.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotOnDomainsDecideRule.html">DecideRule: NotOnDomainsDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that is not in one of the domains of the configured set.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/OnHostsDecideRule.html">DecideRule: OnHostsDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that is in one of the hosts of the configured set.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/NotOnHostsDecideRule.html">DecideRule: NotOnHostsDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that is not in one of the hosts of the configured set.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ScopePlusOneDecideRule.html">DecideRule: ScopePlusOneDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that is one level beyond the configured scope.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/TooManyHopsDecideRule.html">DecideRule: TooManyHopsDecideRule</a></dt><dd><p>This DecideRule rejects any URI whose total number of hops is over the configured threshold.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/TooManyPathSegmentsDecideRule.html">DecideRule: TooManyPathSegmentsDecideRule</a></dt><dd><p>This DecideRule rejects any URI whose total number of path-segments is over the configured threshold.  A
path-segment is a string in the URI separated by a “/” character, not including the first “//”.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/TransclusionDecideRule.html">DecideRule: TransclusionDecideRule</a></dt><dd><p>This DecideRule accepts any URI whose path-from-seed ends in at least one non-navlink hop. A navlink hop is
represented by an “L”.  Also, the number of non-navlink hops in the path-from-seed cannot exceed the configured
value.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/PrerequisiteAcceptDecideRule.html">DecideRule: PrerequisiteAcceptDecideRule</a></dt><dd><p>This DecideRule accepts all “prerequisite” URIs.  Prerequisite URIs are those whose hops-path has a “P” in the
last position.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/RejectDecideRule.html">DecideRule: RejectDecideRule</a></dt><dd><p>This DecideRule rejects any URI.</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/ScriptedDecideRule.html">DecideRule: ScriptedDecideRule</a></dt><dd><p>This DecideRule applies the configured decision to any URI that passes the rules test of a JSR-223 script.  The
script source must be a one-argument function called decisionFor.”  The function returns the appropriate
DecideResult. Variables available to the script include object (the object to be evaluated, such as a URI),
“self” (the ScriptDecideRule instance), and context (the crawl’s ApplicationContext, from which all named crawl
beans are reachable).</p>
</dd>
<dt><a class="reference external" href="https://www.javadoc.io/doc/org.archive.heritrix/heritrix-modules/latest/org/archive/modules/deciderules/SeedAcceptDecideRule.html">DecideRule: SeedAcceptDecideRule</a></dt><dd><p>This DecideRule accepts all “seed” URIs (those for which isSeed is true).</p>
</dd>
</dl>
</section>
<section id="deciderulesequence-logging">
<h3>DecideRuleSequence Logging<a class="headerlink" href="configuring-jobs.html#deciderulesequence-logging" title="Permalink to this heading"></a></h3>
<p>Enable <code class="docutils literal notranslate"><span class="pre">FINEST</span></code> logging on the class <code class="docutils literal notranslate"><span class="pre">org.archive.crawler.deciderules.DecideRuleSequence</span></code> to watch each
DecideRule’s evaluation of the processed URI. This can be done in the <code class="docutils literal notranslate"><span class="pre">logging.properties</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>org.archive.modules.deciderules.DecideRuleSequence.level<span class="w"> </span><span class="o">=</span><span class="w"> </span>FINEST
</pre></div>
</div>
<p>in conjunction with the <code class="docutils literal notranslate"><span class="pre">-Dsysprop</span></code> VM argument,</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-Djava.util.logging.config.file=/path/to/heritrix3/dist/src/main/conf/logging.properties
</pre></div>
</div>
</section>
</section>
<section id="frontier">
<h2>Frontier<a class="headerlink" href="configuring-jobs.html#frontier" title="Permalink to this heading"></a></h2>
<section id="politeness">
<h3>Politeness<a class="headerlink" href="configuring-jobs.html#politeness" title="Permalink to this heading"></a></h3>
<p>A combination of several settings control the politeness of the Frontier. It is important to note that at any given
time only one URI from any given host is processed. The following politeness rules impose additional wait time
between the end of processing one URI and the start of the next one.</p>
<dl class="simple">
<dt>delayFactor</dt><dd><p>This setting imposes a delay between the fetching of URIs from the same host. The delay is a multiple of the
amount of time it took to fetch the last URI downloaded from the host. For example, if it took 800 milliseconds to
fetch the last URI from a host and the <code class="docutils literal notranslate"><span class="pre">delayFactor</span></code> is 5 (a very high value), then the Frontier will wait 4000
milliseconds (4 seconds) before allowing another URI from that host to be processed.</p>
</dd>
<dt>maxDelayMs</dt><dd><p>This setting imposes a maximum upper limit on the wait time created by the <code class="docutils literal notranslate"><span class="pre">delayFactor</span></code>. If set to 1000
milliseconds, then the maximum delay between URI fetches from the same host will never exceed this value.</p>
</dd>
<dt>minDelayMs</dt><dd><p>This setting imposes a minimum limit on politeness. It takes precedence over the value calculated by the
<code class="docutils literal notranslate"><span class="pre">delayFactor</span></code>. For example, the value of <code class="docutils literal notranslate"><span class="pre">minDelayMs</span></code> can be set to 100 milliseconds. If the <code class="docutils literal notranslate"><span class="pre">delayFactor</span></code> only
generates a 20 millisecond wait, the value of <code class="docutils literal notranslate"><span class="pre">minDelayMs</span></code> will override it and the URI fetch will be delayed for
100 milliseconds.</p>
</dd>
</dl>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;disposition&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.postprocessor.DispositionProcessor&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;delayFactor&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;5.0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxDelayMs&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;minDelayMs&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;3000&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="retry-policy">
<h3>Retry Policy<a class="headerlink" href="configuring-jobs.html#retry-policy" title="Permalink to this heading"></a></h3>
<p>The Frontier can be used to limit the number of fetch retries for a URI.  Heritrix will retry fetching a URI because
the initial fetch error may be a transitory condition.</p>
<dl class="simple">
<dt>maxRetries</dt><dd><p>This setting limits the number of fetch retries attempted on a URI due to transient errors.</p>
</dd>
<dt>retryDelaySeconds</dt><dd><p>This setting determines how long the wait period is between retries.</p>
</dd>
</dl>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;frontier&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.frontier.BdbFrontier&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;retryDelaySeconds&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;900&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxRetries&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;30&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="bandwidth-limits">
<h3>Bandwidth Limits<a class="headerlink" href="configuring-jobs.html#bandwidth-limits" title="Permalink to this heading"></a></h3>
<p>The Frontier allows the user to limit bandwidth usage. This is done by holding back URIs when bandwidth usage has
exceeded certain limits. Because bandwidth usage limitations are calculated over a period of time, there can still be
spikes in usage that greatly exceed the limits.</p>
<dl>
<dt>maxPerHostBandwidthUsageKbSec</dt><dd><p>This setting limits the maximum bandwidth to use for any host. This setting limits the load placed by Heritrix on the
host. It is therefore a politeness setting.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;disposition&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.postprocessor.DispositionProcessor&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;maxPerHostBandwidthUsageKbSec&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;500&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="extractor-parameters">
<h3>Extractor Parameters<a class="headerlink" href="configuring-jobs.html#extractor-parameters" title="Permalink to this heading"></a></h3>
<p>The Frontier’s behavior with regard to link extraction can be controlled by the following parameters.</p>
<dl>
<dt>extract404s</dt><dd><p>This setting allows the operator to avoid extracting links from 404 (Not Found) pages. The default is true, which
maintains the pre-3.1 behavior of extracting links from 404 pages.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;frontier&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.frontier.BdbFrontier&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;extract404s&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</dd>
<dt>extractIndependently</dt><dd><p>This setting encourages extractor processors to always perform their best-effort extraction, even if a previous
extractor has marked a URI as already-handled. Set the value to true for best-effort extraction. The default is
false, which maintains the pre-3.1 behavior.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;frontier&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.frontier.BdbFrontier&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;extractIndependently&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</dd>
</dl>
</section>
</section>
<section id="sheets-site-specific-settings">
<h2>Sheets (Site-specific Settings)<a class="headerlink" href="configuring-jobs.html#sheets-site-specific-settings" title="Permalink to this heading"></a></h2>
<p>Sheets provide the ability to replace default settings on a per domain basis. Sheets are collections of overrides.
They contain alternative values for object properties that should apply in certain contexts. The target is specified
as an arbitrarily-long property-path, which is a string describing how to access the property starting from a
beanName in a BeanFactory.</p>
<p>Sheets allow settings to be overlaid with new values that apply by top level domains (com, net, org, etc), by
second-level domains (yahoo.com, archive.org, etc.), by subdomains (crawler.archive.org, tech.groups.yahoo.com, etc.)
, and leading URI paths (directory.google.com/Top/Computers/, etc.). There is no limit for how long the domain/path
prefix which specifies overlays can go; the <a class="reference external" href="https://heritrix.readthedocs.io/en/latest/Glossary_5735753.html#Glossary-Glossary-SURTPrefix">SURT Prefix</a>
syntax is used.</p>
<p>Creating a new sheet involves configuring the <code class="docutils literal notranslate"><span class="pre">crawler-beans.cxml</span></code> file, which contains the Spring configuration of
a job.</p>
<p>For example, if you have explicit permission to crawl certain domains without the usual polite rate-limiting, then a
Sheet can be used to create a less polite crawling policy that is associated with a few such target domains. The
configuration of such a Sheet for the domains example.com and example1.com are shown below. This example allows up to
5 parallel outstanding requests at a time (rather than the default 1), and eliminates any usual pauses between
requests.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unless a target site has given you explicit permission to crawl extra-aggressively, the typical Heritrix defaults,
which limit the crawler to no more than one outstanding request at a time, with multiple-second waits between
requests, and longer waits when the site is responding more slowly, are the safest course. Less-polite crawling
can result in your crawler being blocked entirely by webmasters.</p>
<p>Finally, even with permission, be sure your crawler’s User-Agent string includes a link to valid crawl-operator
contact information so you can be alerted to, and correct, any unintended side-effects.</p>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sheetOverlaysManager&quot;</span><span class="w"> </span><span class="na">autowire=</span><span class="s">&quot;byType&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.crawler.spring.SheetOverlaysManager&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;org.archive.crawler.spring.SurtPrefixesSheetAssociation&#39;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&#39;surtPrefixes&#39;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;list&gt;</span>
<span class="w">      </span><span class="nt">&lt;value&gt;</span>http://(com,example,www,)/<span class="nt">&lt;/value&gt;</span>
<span class="w">      </span><span class="nt">&lt;value&gt;</span>http://(com,example1,www,)/<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/list&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&#39;targetSheetNames&#39;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;list&gt;</span>
<span class="w">      </span><span class="nt">&lt;value&gt;</span>lessPolite<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/list&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&#39;lessPolite&#39;</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;org.archive.spring.Sheet&#39;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&#39;map&#39;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;map&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&#39;disposition.delayFactor&#39;</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;0.0&#39;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&#39;disposition.maxDelayMs&#39;</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;0&#39;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&#39;disposition.minDelayMs&#39;</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;0&#39;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&#39;queueAssignmentPolicy.parallelQueues&#39;</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;5&#39;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/map&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="authentication-and-cookies">
<h2>Authentication and Cookies<a class="headerlink" href="configuring-jobs.html#authentication-and-cookies" title="Permalink to this heading"></a></h2>
<p>Heritrix can crawl sites behind login by using HTTP authentication, submitting a form or by loading cookies from a file.</p>
<section id="credential-store">
<h3>Credential Store<a class="headerlink" href="configuring-jobs.html#credential-store" title="Permalink to this heading"></a></h3>
<p>Credentials can be added so that Heritrix can gain access to areas of web sites requiring authentication. Credentials
need to listed in a CredentialStore.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;credentialStore&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.credential.CredentialStore&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;credentials&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;map&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;exampleHttpCredential&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;exampleHttpCredential&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;exampleFormCredential&quot;</span><span class="w"> </span><span class="na">value-ref=</span><span class="s">&quot;exampleFormCredential&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/map&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>To enable text console logging of authentication interactions, set the FetchHTTP and PreconditionEnforcer log levels to
fine in <code class="docutils literal notranslate"><span class="pre">conf/logging.properties</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>org.archive.crawler.fetcher.FetchHTTP.level = FINE
org.archive.crawler.prefetch.PreconditionEnforcer.level = FINE
</pre></div>
</div>
</section>
<section id="http-basic-and-digest-authentication">
<h3>HTTP Basic and Digest Authentication<a class="headerlink" href="configuring-jobs.html#http-basic-and-digest-authentication" title="Permalink to this heading"></a></h3>
<p>In response to a 401 Unauthorized response code Heritrix will do a lookup of a key based on the domain and
authentication realm in its CredentialStore. If a match is found, then the credential is loaded into the CrawlURI and
the CrawlURI is marked for immediate retry.</p>
<p>When the CrawlURI is retried, the found credentials are added to the request. If the request succeeds with a 200
response code, the credentials are promoted to the CrawlServer and all subsequent requests made against the CrawlServer
will preemptively volunteer the credential. If the credential fails with a 401 response code, the URI is no longer
retried.</p>
<p>The configured domain should be of the form “hostname:port” unless the port is 80 in which case it must be omitted. For
HTTPS URLs without an explicit port use port 443.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exampleHttpCredential&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.credential.HttpAuthenticationCredential&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;www.example.org:443&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;realm&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;myrealm&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;login&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;user&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;secret&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="html-form-authentication">
<h3>HTML Form Authentication<a class="headerlink" href="configuring-jobs.html#html-form-authentication" title="Permalink to this heading"></a></h3>
<p>Heritrix can be configured to submit credentials to a HTML form using a GET or POST request.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;exampleFormCredential&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.credential.HtmlFormCredential&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;example.com&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;loginUri&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;http://example.com/login&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;formItems&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;map&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;login&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;user&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;secret&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;submit&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/map&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<dl class="simple">
<dt>domain</dt><dd><p>The domain should be of the form “hostname:port” unless the port is 80 in which case it must be omitted. For
HTTPS URLs without an explicit port use port 443.</p>
</dd>
<dt>login-uri</dt><dd><p>A relative or absolute URI to which the HTML Form submits. It is not necessarily the page that contains the HTML
Form; rather it is the ACTION URI the to which the form submits.</p>
</dd>
<dt>form-items</dt><dd><p>Form-items are a listing of HTML Form key/value pairs. The submit button usually must be included in the form-items.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is currently no support for successfully submitting forms with dynamic fields whose required name or value
changes for each visitor (such as CSRF tokens).</p>
<p>For a site with an HTML Form credential, a login is performed against all listed HTML Form credential login-uris
after the DNS and robots.txt preconditions are fulfilled.  The crawler will only view sites that have HTML Form
credentials from a logged-in perspective.  There is no current way for a single Heritrix job to crawl a site in an
unauthenticated state and then re-crawl the site in an authenticated state. (You would have to do this in two
separately-configured job launches.)</p>
<p>The form login is only run once.  Heritrix continues crawling regardless of whether the login succeeds. There is no
way of telling Heritrix to retry authentication if the first attempt is not successful.  Neither is there a means for
the crawler to report success or failed authentications.  The crawl operator should examine the logs to determine
whether authentication succeeded.</p>
</div>
</section>
<section id="loading-cookies">
<h3>Loading Cookies<a class="headerlink" href="configuring-jobs.html#loading-cookies" title="Permalink to this heading"></a></h3>
<p>Heritrix can be configured to load a set of cookies from a file. This can be used for example to crawl a website behind
a login form by manually logging in through the browser and then copying the session cookie.</p>
<p>To enable loading of cookies set the cookiesLoadFile property of the BdbCookieStore bean to a ConfigFile:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;cookieStore&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.BdbCookieStore&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cookiesLoadFile&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.spring.ConfigFile&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;path&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cookies.txt&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>The cookies.txt should be in the 7-field tab-separated Netscape cookie file format. An entry might look like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>www.example.org FALSE / FALSE 1311699995 sessionid 60ddb868550a
</pre></div>
</div>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Cookie file tab-separated fields</span><a class="headerlink" href="configuring-jobs.html#id6" title="Permalink to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p>1</p></td>
<td><p>DOMAIN</p></td>
<td><p>The domain that created and has access to the cookie.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>FLAG</p></td>
<td><p>A TRUE or FALSE value indicating if subdomains within the given domain can access the cookie.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>PATH</p></td>
<td><p>The path within the domain that the cookie is valid for.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>SECURE</p></td>
<td><p>A TRUE or FALSE value indicating if the cookie should be sent over HTTPS only.</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>EXPIRATION</p></td>
<td><p>Expiration time in seconds since 1970-01-01T00:00:00Z, or -1 for no expiration</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>NAME</p></td>
<td><p>The name of the cookie.</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>VALUE</p></td>
<td><p>The value of the cookie.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="other-protocols">
<h2>Other Protocols<a class="headerlink" href="configuring-jobs.html#other-protocols" title="Permalink to this heading"></a></h2>
<p>In addition to HTTP/1.0 Heritrix can be configured to fetch resources using several other internet protocols.</p>
<section id="ftp">
<h3>FTP<a class="headerlink" href="configuring-jobs.html#ftp" title="Permalink to this heading"></a></h3>
<p>Heritrix supports crawling <a class="reference external" href="https://en.wikipedia.org/wiki/File_Transfer_Protocol">FTP</a> sites.  Seeds should be added
in the following format: <code class="docutils literal notranslate"><span class="pre">`ftp://sftp.example.org/directory</span></code>.</p>
<p>The FetchFTP bean needs to be defined:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchFTP&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchFTP&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;digestAlgorithm&quot; value=&quot;sha1&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;digestContent&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;extractFromDirs&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;extractParent&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxFetchKBSec&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxLengthBytes&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;password&quot; value=&quot;password&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;soTimeoutMs&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;timeoutSeconds&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;username&quot; value=&quot;anonymous&quot; /&gt; --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>and added to the FetchChain:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchProcessors&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.FetchChain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;processors&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;list&gt;</span>...
<span class="w">    </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;fetchFTP&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span>...
<span class="w">   </span><span class="nt">&lt;/list&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="http-2">
<h3>HTTP/2<a class="headerlink" href="configuring-jobs.html#http-2" title="Permalink to this heading"></a></h3>
<p>To use HTTP/2 the <code class="docutils literal notranslate"><span class="pre">FetchHTTP</span></code> bean should replaced with <code class="docutils literal notranslate"><span class="pre">FetchHTTP2</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchHTTP2&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchHTTP2&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;digestAlgorithm&quot; value=&quot;sha1&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;httpProxyHost&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;httpProxyPort&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxFetchKBSec&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxLengthBytes&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;timeoutSeconds&quot; value=&quot;20&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;useHTTP2&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;useHTTP3&quot; value=&quot;false&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;userAgentProvider&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">FetchHTTP2</span></code> will use HTTP/1.1 for non-https URLs and for servers that do not support HTTP/2. Requests that used HTTP/2
will be annotated with <code class="docutils literal notranslate"><span class="pre">h2</span></code> in the crawl log and <code class="docutils literal notranslate"><span class="pre">WARC-Protocol</span></code> header.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">FetchHTTP2</span></code> currently only supports a limited subset of the <code class="docutils literal notranslate"><span class="pre">FetchHTTP</span></code> options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The WARC standard (as of version 1.1) does not specify how to record HTTP/2 or 3 messages.
FetchHTTP2 does not record the original on-the-wire HTTP messages but instead a simplified HTTP/1.1
representation without transfer encoding.</p>
<p>If you want to stay within the bounds of the base WARC standard without extensions, or want to ensure the exact
bytes of the HTTP network message are recorded, you may prefer to use FetchHTTP.</p>
</div>
</section>
<section id="http-3">
<h3>HTTP/3<a class="headerlink" href="configuring-jobs.html#http-3" title="Permalink to this heading"></a></h3>
<p>HTTP/3 support is experimental and is not enabled by default. First replace <code class="docutils literal notranslate"><span class="pre">FetchHTTP</span></code> with <code class="docutils literal notranslate"><span class="pre">FetchHTTP2</span></code> as described
above and then enable the <code class="docutils literal notranslate"><span class="pre">useHTTP3</span></code> property:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchHttp2&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchHTTP2&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;useHTTP3&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>An appropriate version of the jetty-quiche-native jar also needs to be placed in Heritrix’s <code class="docutils literal notranslate"><span class="pre">lib</span></code> directory. To find out
which version you need, build a job with <code class="docutils literal notranslate"><span class="pre">useHTTP3</span></code> enabled and a warning will be logged to the job log with a download
link.</p>
<p>HTTP/3 requests will only be sent after a server first responds with an <code class="docutils literal notranslate"><span class="pre">Alt-Svc</span></code> header. Requests that used HTTP/3 will
be annotated with <code class="docutils literal notranslate"><span class="pre">h3</span></code> in the crawl log and <code class="docutils literal notranslate"><span class="pre">WARC-Protocol</span></code> header.</p>
</section>
<section id="sftp">
<h3>SFTP<a class="headerlink" href="configuring-jobs.html#sftp" title="Permalink to this heading"></a></h3>
<p>An optional fetcher for <a class="reference external" href="https://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol">SFTP</a> is provided.  Seeds should
be added in the following format:<code class="docutils literal notranslate"><span class="pre">sftp://sftp.example.org/directory</span></code>.</p>
<p>The FetchSFTP bean needs to be defined:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchSFTP&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchSFTP&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;digestAlgorithm&quot; value=&quot;sha1&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;digestContent&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;extractFromDirs&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;extractParent&quot; value=&quot;true&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxFetchKBSec&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;maxLengthBytes&quot; value=&quot;0&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;password&quot; value=&quot;password&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;soTimeoutMs&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;timeoutSeconds&quot; value=&quot;&quot; /&gt; --&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- &lt;property name=&quot;username&quot; value=&quot;anonymous&quot; /&gt; --&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>and added to the FetchChain:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchProcessors&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.FetchChain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;processors&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;list&gt;</span>
<span class="w">      </span>...
<span class="w">      </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;fetchSFTP&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/list&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="whois">
<h3>WHOIS<a class="headerlink" href="configuring-jobs.html#whois" title="Permalink to this heading"></a></h3>
<p>An optional fetcher for domain <a class="reference external" href="https://en.wikipedia.org/wiki/WHOIS">WHOIS</a> data is provided. A small set of
well-established WHOIS servers are preconfigured. The fetcher uses an ad-hoc/intuitive interpretation of a ‘whois:’
scheme URI.</p>
<p>Define the fetchWhois bean:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchWhois&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchWhois&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;specialQueryTemplates&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;map&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;whois.verisign-grs.com&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;domain %s&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;whois.arin.net&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;z + %s&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;whois.denic.de&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;-T dn %s&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/map&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>and add it to the FetchChain:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchProcessors&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.FetchChain&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;processors&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;list&gt;</span>
<span class="w">      </span>...
<span class="w">      </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;fetchWhois&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span>...
<span class="w">    </span><span class="nt">&lt;/list&gt;</span>
<span class="w">  </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<p>To configure a whois seed, enter the seed in the following format: <code class="docutils literal notranslate"><span class="pre">whois://hostname/path</span></code>.  For example,
<code class="docutils literal notranslate"><span class="pre">whois://archive.org</span></code>.  The whois fetcher will attempt to resolve each host that the crawl encounters using the
topmost assigned domain and the ip address of the url crawled. So if you crawl <code class="docutils literal notranslate"><span class="pre">http://www.archive.org/details/texts</span></code>,
the whois fetcher will attempt to resolve <code class="docutils literal notranslate"><span class="pre">whois:archive.org</span></code> and <code class="docutils literal notranslate"><span class="pre">whois:207.241.224.2</span></code>.</p>
<p>At this time, whois functionality is experimental.  The fetchWhois bean is commented out in the default profile.</p>
</section>
</section>
<section id="modifying-a-running-job">
<h2>Modifying a Running Job<a class="headerlink" href="configuring-jobs.html#modifying-a-running-job" title="Permalink to this heading"></a></h2>
<p>While changing a job’s XML configuration normally requires relaunching it, some settings can be modified while the crawl
is running. This is done through the <a class="reference internal" href="configuring-jobs.html#browse-beans">Browse Beans</a> or the <a class="reference internal" href="configuring-jobs.html#scripting-console">Scripting Console</a> link on the job page. The Bean Browser
allows you to edit runtime properties of beans. You can also use the scripting console to programmatically edit
a running job.</p>
<p>If changing a non-atomic value, it is a good practice to pause the crawl prior to making the change, as some
modifications to composite configuration entities may not occur in a thread-safe manner. An example of a non-atomic
change is adding a new Sheet.</p>
<section id="browse-beans">
<h3>Browse Beans<a class="headerlink" href="configuring-jobs.html#browse-beans" title="Permalink to this heading"></a></h3>
<p>The WUI provides a way to view and edit the Spring beans that make up a crawl configuration. It is important to note
that changing the crawl configuration using the Bean Browser will not update the <code class="docutils literal notranslate"><span class="pre">crawler-beans.cxml</span></code> file. Thus,
changing settings with the Bean Browser is not permanent. The Bean Browser should only by used to change the settings
of a running crawl. To access the Bean Browser click on the Browse Beans link from the jobs page. The hierarchy of
Spring beans will be displayed.</p>
<img alt="https://raw.githubusercontent.com/wiki/internetarchive/heritrix3/attachments/5735725/5865655.png" src="https://raw.githubusercontent.com/wiki/internetarchive/heritrix3/attachments/5735725/5865655.png" />
<p>You can drill down on individual beans by clicking on them. The example below shows the display after clicking on the
seeds bean.</p>
<img alt="https://raw.githubusercontent.com/wiki/internetarchive/heritrix3/attachments/5735725/5865656.png" src="https://raw.githubusercontent.com/wiki/internetarchive/heritrix3/attachments/5735725/5865656.png" />
</section>
<section id="scripting-console">
<h3>Scripting Console<a class="headerlink" href="configuring-jobs.html#scripting-console" title="Permalink to this heading"></a></h3>
<p>[This section to be written. For now see the
<a class="reference external" href="https://github.com/internetarchive/heritrix3/wiki/Heritrix3%20Useful%20Scripts">Heritrix3 Useful Scripts</a> wiki page.]</p>
</section>
<section id="configuring-http-proxies">
<h3>Configuring HTTP Proxies<a class="headerlink" href="configuring-jobs.html#configuring-http-proxies" title="Permalink to this heading"></a></h3>
<p>There are two options to specify a proxy for crawling.</p>
<p>The command line options <code class="docutils literal notranslate"><span class="pre">--proxy-host</span></code> and <code class="docutils literal notranslate"><span class="pre">--proxy-port</span></code> can be used to define a proxy for all jobs.
If only the <code class="docutils literal notranslate"><span class="pre">--proxy-host</span></code> option is given, a default value of 8000 is used for the proxy port.
These proxy settings are also used when connecting to a “DNS-over-HTTP” server
(see the <a class="reference external" href="configuring-jobs.html#configuring-dns-over-http-doh">section on DNS-over-HTTP</a> below).</p>
<p>Alternatively one can define a per-job proxy via a the <code class="docutils literal notranslate"><span class="pre">httpProxyHost</span></code> and <code class="docutils literal notranslate"><span class="pre">httpProxyPort</span></code> properties of the
<code class="docutils literal notranslate"><span class="pre">fetchHttp</span></code> bean. These settings, if both defined, will overwrite the global options. These setting also allow for
a user and password in the <code class="docutils literal notranslate"><span class="pre">httpProxyUser</span></code> and <code class="docutils literal notranslate"><span class="pre">httpProxyPassword</span></code> properties, which the global options do not
support, due to incompatibilities of the different supported Java versions.</p>
<p>Also the optional “SOCKS5” proxy documented in the next section is used on a per-job basis; there are currently no
global options to define it.</p>
</section>
<section id="configuring-socks5-proxy">
<h3>Configuring SOCKS5 Proxy<a class="headerlink" href="configuring-jobs.html#configuring-socks5-proxy" title="Permalink to this heading"></a></h3>
<p>An optional configuration value to route Heritrix crawler traffic through a SOCKS5 proxy. This will override any set
HTTP proxy configuration. It is facilitated by extending the <cite>org.archive.modules.fetcher.FetchHTTP</cite> bean with
<cite>socksProxyHost</cite> and <cite>socksProxyPort</cite> values, as in the example below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.archive.modules.fetcher.FetchHTTP&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;fetchHttp&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="cm">&lt;!--  ... --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;socksProxyHost&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;socksProxyPort&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;24000&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</section>
<section id="configuring-dns-over-http-doh">
<h3>Configuring DNS over HTTP (DoH)<a class="headerlink" href="configuring-jobs.html#configuring-dns-over-http-doh" title="Permalink to this heading"></a></h3>
<p>If the local DNS on the server running Heritrix is not able to resolve the DNS names of the crawled sites, e.g. because
the server is sitting behind an enterprise firewall and can only resolve names of the local network, then using
DNS-over-HTTP (DoH) might be an alternative to fetch DNS information.</p>
<p>To activate this, one needs to set the <code class="docutils literal notranslate"><span class="pre">dnsOverHttpServer</span></code> setting of the <code class="docutils literal notranslate"><span class="pre">fetchDns</span></code> bean to the URL of an DoH server.
If one has configured a global proxy via the <code class="docutils literal notranslate"><span class="pre">--proxy-host</span></code> and <code class="docutils literal notranslate"><span class="pre">--proxy-port</span></code> command line options,
these proxy settings will be used to contact the DoH server as well. However due to limitation of the library in use,
username and password information for the proxy are not supported. Also any per-job defined proxy settings in the
<code class="docutils literal notranslate"><span class="pre">fetchHttp</span></code> bean are not used when contacting the DoH server.</p>
<p>As the implementation relies on the corresponding client in the “dnsjava” library, which is currently labeled as
experimental, this option comes with some limitations:</p>
<ul class="simple">
<li><p>If you use Java 11 then due to a <a class="reference external" href="https://bugs.openjdk.java.net/browse/JDK-8221395">well known bug</a> it will not
close connections to the DoH server unless Heritrix shuts down.
As the DoH server might not accept new connections after some limits while these connections are still open, it is
not recommended to use this feature when running Heritrix with Java 11.</p></li>
<li><p>For other Java versions, the connection to the DoH server will be closed when the garbage collector runs.
Depending on the garbage collector used this will cause a delay of anything between a few seconds and several
minutes before closing the connection. Also note that if the garbage collector is explicitely triggered via the
Heritrix UI one needs to add the <code class="docutils literal notranslate"><span class="pre">-XX:-DisableExplicitGC</span></code> option in the <code class="docutils literal notranslate"><span class="pre">JAVA_OPTS</span></code> for Java versions 13 and up
as otherwise this action has no effect.</p></li>
</ul>
<p>Without making a recommendation the following DoH servers have been tested with the DoH feature:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dns.google/dns-query">https://dns.google/dns-query</a></p></li>
<li><p><a class="reference external" href="https://cloudflare-dns.com/dns-query">https://cloudflare-dns.com/dns-query</a></p></li>
</ul>
<p>However servers implementing the official <a class="reference external" href="https://tools.ietf.org/html/rfc8484">RFC 8484</a> specification
unfortunately do not work with the current implementation. This includes e.g. the following server:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dns.digitale-gesellschaft.ch/dns-query">https://dns.digitale-gesellschaft.ch/dns-query</a></p></li>
</ul>
<p>This limitation might be overcome by a newer version of the “dnsjava” library.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="operating.html" class="btn btn-neutral float-left" title="Operating Heritrix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="bean-reference.html" class="btn btn-neutral float-right" title="Bean Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Internet Archive and contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>